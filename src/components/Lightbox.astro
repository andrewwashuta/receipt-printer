---
import { Image } from 'astro:assets';

interface Props {
    image: ImageMetadata;
    alt: string;
    trigger?: string;
}

const { 
    image, 
    alt,
    trigger
} = Astro.props;
---

<div class="lightbox-container">
    {trigger ? (
        <button class="lightbox-trigger text-trigger" aria-label={`View ${alt}`}>
            {trigger}
        </button>
    ) : (
        <button class="lightbox-trigger" aria-label={`View ${alt}`}>
            <Image 
                src={image} 
                alt={alt} 
                width={300} 
                quality={100}
                format="webp"
                class="thumbnail"
            />
        </button>
    )}

    <div class="lightbox" role="dialog" aria-modal="true">
        <button class="lightbox-close" aria-label="Close lightbox">Ã—</button>
        <div class="lightbox-content">
            <Image 
                src={image} 
                alt={alt} 
                width={1200} 
                quality={100}
                format="webp"
                class="lightbox-image"
            />
        </div>
    </div>
</div>

<style>
    .lightbox-container {
        display: inline-block;
    }

    .lightbox-trigger {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
        display: inline-block;
    }

    .text-trigger {
        color: var(--color-accent-dark);
        text-decoration: underline;
        text-underline-offset: 0.2em;
        font-family: inherit;
        font-size: inherit;
    }

    .text-trigger:hover {
        color: var(--color-accent-light);
    }

    .thumbnail {
        transition: opacity var(--transition-default);
    }

    .thumbnail:hover {
        opacity: 0.8;
    }

    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: grid;
        place-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity var(--transition-default), visibility var(--transition-default);
    }

    .lightbox.visible {
        opacity: 1;
        visibility: visible;
    }

    .lightbox-close {
        position: absolute;
        top: var(--size-md);
        right: var(--size-md);
        background: none;
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        padding: var(--size-xs);
        line-height: 1;
    }

    .lightbox-content {
        max-width: 90vw;
        max-height: 90vh;
    }

    .lightbox-image {
        width: auto;
        height: auto;
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
    }
</style>

<script>
    document.addEventListener('astro:page-load', () => {
        const containers = document.querySelectorAll('.lightbox-container');
        
        containers.forEach(container => {
            const trigger = container.querySelector('.lightbox-trigger');
            const lightbox = container.querySelector('.lightbox');
            const closeBtn = lightbox?.querySelector('.lightbox-close');

            trigger?.addEventListener('click', () => {
                lightbox?.classList.add('visible');
                document.body.style.overflow = 'hidden';
            });

            const closeLightbox = () => {
                lightbox?.classList.remove('visible');
                document.body.style.overflow = '';
            };

            closeBtn?.addEventListener('click', closeLightbox);
            
            lightbox?.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && lightbox?.classList.contains('visible')) {
                    closeLightbox();
                }
            });
        });
    });
</script> 