---
import { Image } from 'astro:assets';

interface Props {
    id: string;
    imageUrl?: ImageMetadata;
    imageAlt?: string;
    width?: number;
    height?: number;
    class?: string;
}

const { id, imageUrl, imageAlt, width, height, class: className } = Astro.props;
---

<div class="modal" data-modal-id={id} role="dialog" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-container">
        {imageUrl && (
            <Image 
                src={imageUrl} 
                alt={imageAlt || ''} 
                quality={100}
                class="modal-image"
                loading="eager"
                {...(width ? { width } : {})}
                {...(height ? { height } : {})}
            />
        )}
    </div>
</div>

<style>
    .modal {
        position: fixed;
        inset: 0;
        z-index: var(--z-modal);
        display: none;
    }
    .modal.visible {
        display: flex;
    }
    .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(40, 39, 38, 0.85); /* or use var(--color-ink-primary) with opacity */
        z-index: 1;
    }
    .modal-container {
        position: relative;
        z-index: 2;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
    }
    .modal-image {
        height: 90vh;
        width: auto;
        max-width: 90vw;
        object-fit: contain;
        display: block;
        margin: auto;
        box-shadow: var(--shadow-lg);
        pointer-events: auto;
        border-radius: 0;
        padding: 0;
        border:0;
    }

    /* Modal trigger styles */
    :global(.modal-trigger) {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

    :global(.modal-trigger:has(img))::after {
        content: '';
        position: absolute;
        inset: -4px;
        border: 4px solid var(--color-edge-subtle);
        border-radius: calc(var(--border-radius-sm) + 4px);
        opacity: 0;
        transition: opacity var(--transition-default);
    }

    :global(.modal-trigger:has(img):hover)::after,
    :global(.modal-trigger:has(img):focus)::after {
        opacity: 1;
    }

    /* Remove all focus outlines */
    :global(.modal-trigger:focus),
    :global(.modal-trigger:focus img) {
        outline: none !important;
        box-shadow: none !important;
    }

    /* Remove focus outline from images in modal triggers when modal is closed */
    :global(.modal:not(.visible) ~ .modal-trigger:focus img) {
        outline: none !important;
        box-shadow: none !important;
    }
</style> 