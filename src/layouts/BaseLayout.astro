---
import '../styles/global.scss';
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title?: string;
}

const { title } = Astro.props;
const siteName = "Andrew Washuta";
const pageTitle = title ? `${title} â€“ ${siteName}` : siteName;
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={title ? `${title} | ${siteName}` : siteName} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{pageTitle}</title>
    <ViewTransitions />
  </head>
  <body>
    <slot />
  </body>
</html> 

<script is:inline type="module">
  document.addEventListener('astro:page-load', () => {
      // Get all modal triggers and modals
      const triggers = document.querySelectorAll('.modal-trigger');
      const modalBackdrops = document.querySelectorAll('.modal-backdrop');
      const closeButtons = document.querySelectorAll('.modal-close');

      // Function to close modal
      const closeModal = (modal) => {
          modal.classList.remove('visible');
          document.body.style.overflow = 'auto';
          // Wait for the transition to complete before hiding the modal
          setTimeout(() => {
              modal.style.display = 'none';
          }, 500); // Match this to your --transition-smooth duration
      };

      // Add click handlers to triggers
      triggers.forEach(trigger => {
          trigger.addEventListener('click', () => {
              const modalId = trigger.getAttribute('data-modal-id');
              const modal = document.querySelector(`.modal[data-modal-id="${modalId}"]`);
              
              if (modal) {
                  modal.style.display = 'block';
                  // Force a reflow before adding the visible class
                  modal.offsetHeight;
                  modal.classList.add('visible');
                  document.body.style.overflow = 'hidden';
              }
          });
      });

      // Close when clicking backdrop
      modalBackdrops.forEach(backdrop => {
          backdrop.addEventListener('click', (e) => {
              const modal = backdrop.closest('.modal');
              if (modal && e.target === backdrop) {
                  e.stopPropagation(); // Stop event from bubbling
                  closeModal(modal);
              }
          });
      });

      // Close when clicking close button
      closeButtons.forEach(button => {
          button.addEventListener('click', () => {
              const modal = button.closest('.modal');
              if (modal) closeModal(modal);
          });
      });

      // Close on escape key
      document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
              const visibleModal = document.querySelector('.modal.visible');
              if (visibleModal) closeModal(visibleModal);
          }
      });
  });
</script>