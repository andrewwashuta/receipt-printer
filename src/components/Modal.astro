---
import { Image } from 'astro:assets';

interface Props {
    id: string;
    imageUrl?: ImageMetadata | string;
    imageAlt?: string;
    width?: number;
    height?: number;
    class?: string;
    mediaType?: 'image' | 'video';
}

const { id, imageUrl, imageAlt, width, height, class: className, mediaType = 'image' } = Astro.props;
---

<div class="modal" data-modal-id={id} role="dialog" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-container">
        {imageUrl && mediaType === 'image' ? (
            typeof imageUrl === 'object' && 'src' in imageUrl ? (
                <Image 
                    src={imageUrl} 
                    alt={imageAlt || ''} 
                    quality={100}
                    class="modal-image"
                    loading="eager"
                    {...(width ? { width } : {})}
                    {...(height ? { height } : {})}
                />
            ) : (
                <img
                    src={imageUrl as string}
                    alt={imageAlt || ''}
                    class="modal-image"
                    loading="eager"
                    {...(width ? { width } : {})}
                    {...(height ? { height } : {})}
                />
            )
        ) : imageUrl && mediaType === 'video' ? (
            <video 
                src={imageUrl as string}
                class="modal-image"
                preload="auto"
                muted
                playsinline
                loop
                autoplay
            />
        ) : null}
    </div>
</div>

<style>
    .modal {
        position: fixed;
        inset: 0;
        z-index: var(--z-modal);
        display: none;
    }
    .modal.visible {
        display: flex;
    }
    .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(40, 39, 38, 0.85); /* or use var(--color-ink-primary) with opacity */
        z-index: 1;
    }
    .modal-container {
        position: relative;
        z-index: 2;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
    }
    .modal-image {
        max-height: 90vh;
        max-width: 90vw;
        width: auto;
        height: auto;
        display: block;
        margin: auto;
        box-shadow: var(--shadow-lg);
        pointer-events: auto;
        border-radius: 0;
        padding: 0;
        border: 0;
    }

    /* Modal trigger styles */
    :global(.modal-trigger) {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

    :global(.modal-trigger:has(img))::after,
    :global(.modal-trigger:has(video))::after {
        content: '';
        position: absolute;
        inset: -4px;
        border: 4px solid var(--color-edge-subtle);
        border-radius: 12px;
        opacity: 0;
        transition: opacity var(--transition-default);
    }

    :global(.modal-trigger:has(img):hover)::after,
    :global(.modal-trigger:has(img):focus)::after,
    :global(.modal-trigger:has(video):hover)::after,
    :global(.modal-trigger:has(video):focus)::after {
        opacity: 1;
    }

    :global(.modal-trigger:focus),
    :global(.modal-trigger:focus img),
    :global(.modal-trigger:focus video) {
        outline: none !important;
        box-shadow: none !important;
    }

    :global(a.modal-trigger) {
        cursor: pointer;
    }
    
    :global(a.modal-trigger:focus) {
        color: var(--color-accent-dark) !important;
        outline: none;
    }

    :global(.modal:not(.visible) ~ .modal-trigger:focus img),
    :global(.modal:not(.visible) ~ .modal-trigger:focus video) {
        outline: none !important;
        box-shadow: none !important;
    }
</style> 